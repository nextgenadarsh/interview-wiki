<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Make Batch API Call</title>
</head>

<body>
    <h1>Batch API Call</h1>

</body>
<script>
    const allids = [];
    const promises = {};
    
    const sendRequest = (id) => {
        allids.push(id);

        const promise = new Promise((resolve) => {
            promises[id] = resolve;

            debounce(() => {
                fetch(`https://dummyjson.com/cart?id=${allids.join(",")}`)
                    .then(res => res.json())
                    .then(response => {
                        for (let [key, value] of Object.entries(promises)) {
                            value(response.carts.find(c => c.id == key))
                        }
                    });
            }, 2000)();
        });
        return promise;
    }

    let timer;
    function debounce(func, timeout = 3000) {
        return (...args) => {
            clearTimeout(timer);
            timer = setTimeout(() => { func.apply(this, args); }, timeout);
        };
    }

    function get_cart(id) {
        return sendRequest(id);
    };

    get_cart(1).then(data => {
        console.log(`Received 1: `, data);
    });
    get_cart(2).then(data => {
        console.log(`Received 2: `, data);
    });
</script>

</html>